<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-layout/app-grid/app-grid-style.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="topic-index-tile.html">

<dom-module id="topic-index">
  <template>
    <style include="app-grid-style shared-styles">
      :host {
        display: block;
        --app-grid-columns: 3;
        --app-grid-gutter: 1rem;
        --app-grid-expandible-item-columns: 2;
        --paper-icon-button-ink-color: white;
        background: var(--app-white-color);
      }

      ul {
        padding: 0;
        list-style: none;
      }

      .item {
        position: relative;
        box-shadow: none;
      }

      .item-bg {
        background-color: var(--app-main-color);
        width: 100%; height: 100%;
        position: relative;
        z-index: 4;
      }

      .item, .item-bg {
        -webkit-transition: all 0.3s ease;
           -moz-transition: all 0.3s ease;
             -o-transition: all 0.3s ease;
            -ms-transition: all 0.3s ease;
                transition: all 0.3s ease;
      }

      .item:hover {
        -webkit-box-shadow: 2px 2px 5px rgba(0,0,0,.8);
           -moz-box-shadow: 2px 2px 5px rgba(0,0,0,.8);
                box-shadow: 2px 2px 5px rgba(0,0,0,.8);
      }

      .item:hover > .item-bg {
      }

      .item-title {
        position: absolute;
        z-index: 6;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.5);
        color: white;
        font-weight: 400;
        padding: 16px;
      }

      /* Every other row should be an expendanded item */
      .item:nth-child(5n + 1) {
        @apply --app-grid-expandible-item;
      }

      .item:nth-child(n) {
        height: 250px;
      }

      .item:nth-child(5n + 1), .item:nth-child(5n + 2) {
        height: 40vmax;
      }

      @media(max-width: 799px) {

        .centered-container {
          margin: 10px 5px;
        }

        .item:nth-child(5n+2) {
          height: inherit;
        }

        :host {
          --app-grid-columns: 2;
          --app-grid-gutter: 5px;
          --app-grid-item-height: 200px;
        }

      }

      #topics {
        padding: 1rem;
        margin-top: 70px;
      }

    </style>

    <polynews-nav></polynews-nav>

    <iron-ajax
      auto
      id="request"
      url="https://agora-be.herokuapp.com/topics"
      handle-as="json"
      on-response="handleResponse"
      debounce-duration="300">
    </iron-ajax>

    <div class="centered">
      <template is="dom-if" if="[[!first_articles.length]]">
        <div class="missing">
          <iron-icon class="big-icon" icon="inbox"></iron-icon>
          <h1>No more news!</h1>
          <p>It seems that we are out of news topics. Come back later for more!</p>
        </div>
      </template>
      <ul class="app-grid" id="topics">
        <!-- For each topic make a tile -->
        <template is="dom-repeat" items="{{topics}}" as="topic">
          <li class="item">
            <topic-index-tile topic="{{topic}}"></topic-index-tile>
          </li>
        </template>
      </ul>
    </div>

  </template>

  <script type="text/javascript">
    class TopicIndex extends Polymer.Element {
      static get is() { return 'topic-index'; }

      static get properties() {
      }

      constructor() {
        super();
        this.topics = [];
      }

      handleResponse(data) {
        this.topics = data.detail.response.results;
        // console.log("TOO LONG");
        // data.detail.response.forEach( function (item, index) {
        //   console.log(item);
        //   // TODO: REMOVE BELOW
        //   if (index < 50) {
        //     this.push('topics', item);
        //   }
        // }, this);
      }
    }

    window.customElements.define(TopicIndex.is, TopicIndex);
  </script>
</dom-module>
