<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-layout/app-grid/app-grid-style.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="shared-styles.html">

<dom-module id="topic-index-tile">
  <template>
    <style inclue="shared-styles">
        .item-bg {
          background-color: var(--app-main-color);
          width: 100%; height: 100%;
          position: relative;
          z-index: 4;
        }

        .item-bg {
          -webkit-transition: all 0.3s ease;
             -moz-transition: all 0.3s ease;
               -o-transition: all 0.3s ease;
              -ms-transition: all 0.3s ease;
                  transition: all 0.3s ease;
        }

        .item-title {
          position: absolute;
          z-index: 6;
          bottom: 0;
          left: 0;
          right: 0;
          background-color: rgba(0, 0, 0, 0.5);
          color: white;
          font-weight: 400;
          padding: 16px;
        }
    </style>

    <iron-ajax
      auto
      id="article"
      handle-as="json"
      on-response="collectTitle">
    </iron-ajax>

    <a href="/topic-page/{{topic.id}}">
    <iron-image preload
                id="article-image"
                class="item-bg"
                sizing="cover"
                src="{{image}}"></iron-image>
    <div class="item-title">{{topic.title}}</div>
    </a>

  </template>


  <script>
    class TopicIndexTile extends Polymer.Element {
      static get is() { return 'topic-index-tile'; }

      static get properties() {
        return {
          topic: Object,
          image: String
        }
      }

      ready() {
        super.ready();
        this.$.article.url = this.topic.article_set[0];
      }

      collectTitle(data) {
        var fst_art = data.detail.response;
        if (this.topic === null) {
          console.log("IT IS NULL");
        } else {
          console.log(fst_art.url_image);
          this.image = fst_art.url_image;
          this.topic.title = fst_art.headline;
        }
      }
    }

    window.customElements.define(TopicIndexTile.is, TopicIndexTile);
  </script>
</dom-module>
