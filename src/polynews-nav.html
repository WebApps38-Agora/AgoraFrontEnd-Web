<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="shared-styles.html">

<dom-module id="polynews-nav">
  <template>
    <style include="shared-styles">

      #nav-home {
        margin-right: 0.5rem;
      }

      app-header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 999;
        color: var(--app-white-color);
        background-color: var(--app-dark-color);
        box-shadow: 1px 0px 5px black;
        display: inline-flex;
      }

      app-header paper-icon-button {
        --paper-icon-button-ink-color: white;
      }

      a:visited, a:hover, a {
        text-decoration: none;
        color: white;
      }

      .snd-title {
        width: 284px;
        text-align: center;
        float: right;
        /*border-left: 1px solid var(--app-black-color);*/
      }

      .snd-title:before {
        content: "";
        height: 44px;
        position: absolute;
        top: 10px;
        right: 299px;
        width: 1px;
        background-color: var(--app-white-color);
        -webkit-box-shadow: 0px 0px 5px var(--app-black-color);
           -moz-box-shadow: 0px 0px 5px var(--app-black-color);
                box-shadow: 0px 0px 5px var(--app-black-color);
      }

      .animated-dialog {
        width: 100px;
        height: 100px;
        background: red;
        -webkit-transition: width 2s; /* Safari */
        transition: width 2s;
      }


      .submit {
          margin: 1rem auto;
      }

    </style>

    <app-header fixed>
      <app-toolbar>
        <a href="[[rootPath]]" tabindex="-1">
          <paper-icon-button id="nav-home" icon="home"></paper-icon-button>
        </a>
        <div main-title>{{title}}</div>
          <paper-icon-button id="login" icon="account-circle"
                             onclick="dialog.open();"></paper-icon-button>
          <paper-dialog id="dialog">
            <h2>Login</h2>
            <paper-input id="username" label="username">
            </paper-input>
            <paper-input id="password" label="password" type="password">
            </paper-input>

            <paper-button id="nav-home" class="submit" on-click="send_request"> Submit </paper-button>
          </paper-dialog>
        <template is="dom-if" if="{{withSidebar}}">
          <div class="snd-title">Headlines</div>
        </template>
      </app-toolbar>
    </app-header>

    <iron-ajax id="ajax"
               handle-as="json"
               content-type="application/json"
               method="POST"
               on-response="handleResponse"
               on-error="handleError"
               debounce-duration="300">
    </iron-ajax>

  </template>

  <script>
    class PolynewsNav extends Polymer.Element {
      static get is() { return 'polynews-nav'; }

      static get properties() {
        return {
          rootPath: String,
          withSidebar: Boolean,
          title: {
            type: String,
            value: "Polynews"
          },
          token: {
            type: String,
            value: ""
          },
        }
      }

      send_request () {
        ajax.url = "https://agora-be.herokuapp.com/rest_auth/login/";
        ajax.body = {username:this.$.username.value, password: this.$.password.value};
        ajax.generateRequest();
        this.close();
      }

      handleResponse(data) {
        this.token = console.log(data.detail.response.key);
        console.log(data.detail.response);
        alert(data.detail.response.key);
      }

      handleError(data) {
        alert(String(data.detail.error));
        alert(String(data.detail.request.xhr.response));
      }
    }

    window.customElements.define(PolynewsNav.is, PolynewsNav);
  </script>
</dom-module>
